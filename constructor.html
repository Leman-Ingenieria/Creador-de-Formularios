<!DOCTYPE html>
<html>
<head>
  <title>Constructor de Formularios</title>
  <style>
    body {
      margin: 0;
      display: flex;
      font-family: sans-serif;
    }
    aside {
      width: 220px;
      background-color: #143757;
      color: white;
      height: 100vh;
      padding: 20px;
      box-sizing: border-box;
    }
    main {
      flex: 1;
      padding: 20px;
      background-color: #f5f5f5;
    }
    h2 {
      text-align: center;
    }
    button, select, input, textarea {
      padding: 8px;
      margin: 5px 0;
      width: 100%;
      box-sizing: border-box;
    }
    .form-list select {
      width: calc(100% - 10px);
    }
  </style>
</head>
<body>
  <aside>
    <h3>Menú</h3>
    <div>
      <button onclick="toggleSubmenu()">Formularios ▼</button>
      <div id="submenu" style="margin-left: 10px; display: none;">
        <button onclick="mostrarVista('verEditar')">Ver/Editar</button>
        <button onclick="mostrarVista('nuevo')">Nuevo</button>
      </div>
    </div>
    <div style="margin-top: 20px;">
      <button disabled>Configuración ⚙️<br><small>(próximamente)</small></button>
    </div>
  </aside>

  <main>
    <h2>Entorno de Trabajo</h2>
    <div id="contenedor"></div>
  </main>

  <script>
    const urlWebApp = "https://script.google.com/macros/s/AKfycbxs4YjQT2QHS3quSyVQLbbv57RIZcI8C2PRcMQoDAs1qSmX9CdmMRp5K6YgUyjf9dqV/exec";
    const contenedor = document.getElementById("contenedor");

    function toggleSubmenu() {
      const submenu = document.getElementById("submenu");
      submenu.style.display = submenu.style.display === "none" ? "block" : "none";
    }

    function mostrarVista(vista) {
      contenedor.innerHTML = "";
      if (vista === "verEditar") {
        mostrarVerEditar();
      } else if (vista === "nuevo") {
        mostrarNuevoFormulario();
      }
    }

    async function mostrarVerEditar() {
      contenedor.innerHTML = "<p>Cargando formularios...</p>";
      const res = await fetch(urlWebApp + "?action=listarFormularios");
      const json = await res.json();

      if (json.status === "ok") {
        const select = document.createElement("select");
        select.id = "formSelector";
        json.formularios.forEach(f => {
          const opt = document.createElement("option");
          opt.value = f.id;
          opt.textContent = f.titulo;
          select.appendChild(opt);
        });

        const verBtn = document.createElement("button");
        verBtn.textContent = "Ver";
        verBtn.onclick = () => {
          const id = select.value;
          window.open(`formulario.html?id=${id}`, "_blank");
        };

        const editarBtn = document.createElement("button");
        editarBtn.textContent = "Editar";
        editarBtn.onclick = () => {
          const id = select.value;
          window.location.href = `editar.html?id=${id}`;
        };

        const eliminarBtn = document.createElement("button");
        eliminarBtn.textContent = "Eliminar";
        eliminarBtn.onclick = async () => {
          if (confirm("¿Estás seguro que deseas eliminar este formulario? Esta acción no se puede deshacer.")) {
            const id = select.value;
            const res = await fetch(urlWebApp, {
              method: "POST",
              body: JSON.stringify({ action: "eliminarFormulario", id }),
            });
            const json = await res.json();
            if (json.status === "ok") {
              alert("Formulario eliminado.");
              mostrarVerEditar();
            } else {
              alert("Error al eliminar.");
            }
          }
        };

        contenedor.innerHTML = "";
        contenedor.appendChild(select);
        contenedor.appendChild(verBtn);
        contenedor.appendChild(editarBtn);
        contenedor.appendChild(eliminarBtn);
      } else {
        contenedor.innerHTML = "<p>Error al cargar formularios.</p>";
      }
    }

    function mostrarNuevoFormulario() {
      window.location.href = "constructor.html";
    }
  </script>
</body>
</html>

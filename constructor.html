<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Constructor de Formularios</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      display: flex;
      height: 100vh;
      background-color: #143757;
      color: white;
    }
    #menu {
      width: 220px;
      background: #0f2a4a;
      padding: 20px;
      box-sizing: border-box;
      display: flex;
      flex-direction: column;
    }
    #menu button {
      background: none;
      border: none;
      color: white;
      font-size: 16px;
      padding: 15px 10px;
      text-align: left;
      cursor: pointer;
      border-left: 4px solid transparent;
      margin-bottom: 5px;
    }
    #menu button.active {
      border-left: 4px solid #5dade2;
      background-color: #1b3b6f;
      font-weight: bold;
    }
    #contenido {
      flex-grow: 1;
      padding: 25px;
      overflow-y: auto;
    }
    h2 {
      margin-top: 0;
    }
    #formularioNuevo {
      margin-bottom: 30px;
    }
    label, input, select, textarea, button {
      display: block;
      width: 100%;
      margin-top: 10px;
      font-size: 14px;
    }
    input, select, textarea {
      padding: 8px;
      border-radius: 4px;
      border: none;
      box-sizing: border-box;
    }
    button.guardar {
      margin-top: 20px;
      padding: 10px;
      background: #5dade2;
      color: #143757;
      font-weight: bold;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    #listaFormularios .formulario-item {
      background: #1b3b6f;
      margin-bottom: 10px;
      padding: 10px;
      border-radius: 4px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    #listaFormularios .formulario-item span {
      flex-grow: 1;
    }
    #listaFormularios button {
      margin-left: 8px;
      background: #2980b9;
      border: none;
      color: white;
      padding: 6px 12px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 13px;
    }
    #listaFormularios button:hover {
      background: #1f5a85;
    }
  </style>
</head>
<body>

  <div id="menu">
    <button id="btnFormularios" class="active" onclick="mostrarSeccion('formularios')">FORMULARIOS</button>
    <button id="btnConfiguracion" onclick="mostrarSeccion('configuracion')">CONFIGURACIÓN</button>
  </div>

  <div id="contenido">
    <!-- Sección Formularios -->
    <div id="seccion-formularios">
      <h2>Formularios creados</h2>
      <div id="listaFormularios">Cargando...</div>
    </div>

    <!-- Sección Configuración -->
    <div id="seccion-configuracion" style="display:none;">
      <h2>Configuración</h2>
      <label for="colorFondo">Color de fondo:</label>
      <input type="color" id="colorFondo" value="#143757" />

      <label for="colorTexto">Color de letra:</label>
      <input type="color" id="colorTexto" value="#ffffff" />

      <label for="logo">Subir logo (PNG/JPG):</label>
      <input type="file" id="logo" accept="image/png, image/jpeg" />

      <div id="previewLogo" style="margin-top:15px;"></div>
    </div>
  </div>

  <script>
    const urlWebApp = "https://script.google.com/macros/s/AKfycbxs4YjQT2QHS3quSyVQLbbv57RIZcI8C2PRcMQoDAs1qSmX9CdmMRp5K6YgUyjf9dqV/exec";

    // Cambiar secciones
    function mostrarSeccion(seccion) {
      document.getElementById("seccion-formularios").style.display = seccion === 'formularios' ? 'block' : 'none';
      document.getElementById("seccion-configuracion").style.display = seccion === 'configuracion' ? 'block' : 'none';

      document.getElementById("btnFormularios").classList.toggle("active", seccion === 'formularios');
      document.getElementById("btnConfiguracion").classList.toggle("active", seccion === 'configuracion');
    }

    // Cargar lista de formularios
    async function cargarListaFormularios() {
      const cont = document.getElementById("listaFormularios");
      cont.textContent = "Cargando...";

      try {
        const res = await fetch(urlWebApp + "?action=getFormularios");
        const json = await res.json();

        if (json.status !== "ok") {
          cont.textContent = "Error al cargar los formularios.";
          return;
        }

        if (!json.formularios.length) {
          cont.textContent = "No hay formularios creados.";
          return;
        }

        // Ordenar alfabeticamente por titulo
        json.formularios.sort((a,b) => a.titulo.localeCompare(b.titulo));

        cont.innerHTML = "";
        json.formularios.forEach(f => {
          const div = document.createElement("div");
          div.className = "formulario-item";
          div.innerHTML = `
            <span>${f.titulo}</span>
            <button onclick="verFormulario('${f.id}')">Ver</button>
            <button onclick="editarFormulario('${f.id}')">Editar</button>
          `;
          cont.appendChild(div);
        });
      } catch (e) {
        cont.textContent = "Error al cargar los formularios.";
      }
    }

    function verFormulario(id) {
      window.open(`formulario.html?id=${encodeURIComponent(id)}`, "_blank");
    }

    function editarFormulario(id) {
      window.open(`editar.html?id=${encodeURIComponent(id)}`, "_blank");
    }

    // Evento logo preview
    document.getElementById("logo").addEventListener("change", e => {
      const preview = document.getElementById("previewLogo");
      preview.innerHTML = "";
      const file = e.target.files[0];
      if (file) {
        const img = document.createElement("img");
        img.style.maxWidth = "150px";
        img.style.maxHeight = "100px";
        img.src = URL.createObjectURL(file);
        preview.appendChild(img);
      }
    });

    // Al cargar la página
    window.onload = () => {
      cargarListaFormularios();
    };
  </script>
</body>
</html>

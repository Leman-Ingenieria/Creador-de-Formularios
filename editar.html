<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Editar Formularios</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #f0f0f0;
    }
    h1 {
      text-align: center;
    }
    select {
      padding: 8px;
      width: 100%;
      max-width: 400px;
      margin-bottom: 15px;
    }
    button {
      margin-right: 10px;
      padding: 8px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    .acciones {
      margin-top: 10px;
    }
    .mensaje {
      font-style: italic;
      color: #666;
      margin-top: 15px;
    }
  </style>
</head>
<body>

  <h1>Editar Formularios</h1>

  <div id="contenedor">
    <p class="mensaje">Cargando formularios...</p>
  </div>

  <script>
    const urlWebApp = "https://script.google.com/macros/s/AKfycbxs4YjQT2QHS3quSyVQLbbv57RIZcI8C2PRcMQoDAs1qSmX9CdmMRp5K6YgUyjf9dqV/exec";

    let formularios = [];
    let idSeleccionado = "";

    async function cargarFormularios() {
      const contenedor = document.getElementById("contenedor");

      try {
        const res = await fetch(urlWebApp + "?action=getFormularios");
        const json = await res.json();

        if (json.status === "ok" && json.formularios.length > 0) {
          formularios = json.formularios;

          const select = document.createElement("select");
          select.id = "selectFormularios";

          formularios.forEach(f => {
            const option = document.createElement("option");
            option.value = f.id;
            option.textContent = f.titulo;
            select.appendChild(option);
          });

          select.onchange = () => {
            idSeleccionado = select.value;
          };
          idSeleccionado = select.value;

          contenedor.innerHTML = "";
          contenedor.appendChild(select);

          const acciones = document.createElement("div");
          acciones.className = "acciones";

          const btnVer = document.createElement("button");
          btnVer.textContent = "Ver";
          btnVer.onclick = () => {
            const titulo = formularios.find(f => f.id === idSeleccionado)?.titulo || "Formulario";
            window.open(`responder.html?form=${encodeURIComponent(titulo.replace(/\s+/g, "-"))}`, "_blank");
          };

          const btnEliminar = document.createElement("button");
          btnEliminar.textContent = "Eliminar";
          btnEliminar.onclick = async () => {
            if (confirm("¿Estás seguro de que querés eliminar este formulario?")) {
              try {
                const res = await fetch(urlWebApp, {
                  method: "POST",
                  body: JSON.stringify({
                    action: "eliminarFormulario",
                    id: idSeleccionado
                  })
                });
                const json = await res.json();
                if (json.status === "ok") {
                  alert("Formulario eliminado correctamente.");
                  location.reload();
                } else {
                  alert("Error al eliminar formulario.");
                }
              } catch (e) {
                alert("Error al conectar con el servidor.");
              }
            }
          };

          acciones.appendChild(btnVer);
          acciones.appendChild(btnEliminar);
          contenedor.appendChild(acciones);

        } else {
          contenedor.innerHTML = `<p class="mensaje">No hay formularios disponibles.</p>`;
        }
      } catch (e) {
        contenedor.innerHTML = `<p class="mensaje">Error al cargar formularios.</p>`;
      }
    }

    window.onload = cargarFormularios;
  </script>

</body>
</html>
